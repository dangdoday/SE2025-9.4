import{d as E,r as d,o as D,C as L,c as i,k as o,u as R,b as t,f as w,g as x,z as h,F as S,p as B,t as c,v as C,q as F,A as M,E as _}from"./index-2Haz5s36.js";import{i as I,L as T}from"./index-8VjjxCB0.js";const V=E({__name:"CumProfitChart",props:{data:{}},setup(k){const f=k,u=d(null);let n=null;function g(){u.value&&(n=I(u.value,"dark"),v())}function v(){if(!n||!f.data)return;const l=[],r=[];let a=0;for(let y=0;y<30;y++){const m=new Date;m.setDate(m.getDate()-(30-y)),l.push(m.toLocaleDateString()),a+=(Math.random()-.3)*10,r.push(a)}const b={backgroundColor:"transparent",grid:{left:50,right:20,top:20,bottom:40},tooltip:{trigger:"axis",backgroundColor:"#1E2329",borderColor:"#2B3139",textStyle:{color:"#EAECEF"}},xAxis:{type:"category",data:l,axisLine:{lineStyle:{color:"#2B3139"}},axisLabel:{color:"#848E9C",fontSize:10}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#2B3139"}},axisLabel:{color:"#848E9C"},splitLine:{lineStyle:{color:"#2B3139"}}},series:[{type:"line",data:r,smooth:!0,lineStyle:{color:"#F0B90B",width:2},areaStyle:{color:new T(0,0,0,1,[{offset:0,color:"rgba(240, 185, 11, 0.3)"},{offset:1,color:"rgba(240, 185, 11, 0)"}])},itemStyle:{color:"#F0B90B"}}]};n.setOption(b)}return D(()=>{g(),window.addEventListener("resize",()=>n==null?void 0:n.resize())}),L(()=>f.data,v,{deep:!0}),(l,r)=>(o(),i("div",{ref_key:"chartRef",ref:u,class:"w-full h-full min-h-[300px]"},null,512))}}),z={class:"space-y-6 fade-in"},U={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},$={class:"card"},P={class:"space-y-4"},j=["value"],q=["value"],N={class:"grid grid-cols-2 gap-3"},G={key:0,class:"pt-4"},O={class:"flex justify-between text-sm mb-2"},W={class:"text-primary"},H={class:"w-full h-2 bg-dark-100 rounded-full overflow-hidden"},J={class:"pt-4 flex gap-3"},K={class:"lg:col-span-2 space-y-4"},Q={key:0,class:"card"},X={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Y={class:"stat-value stat-positive"},Z={class:"stat-value text-success"},tt={class:"stat-value text-white"},et={class:"stat-value stat-negative"},st={class:"card"},at={class:"h-80"},lt={key:1,class:"h-full flex items-center justify-center text-gray-500"},it=E({__name:"BacktestingView",setup(k){const f=R(),u=d("RSI_EMA"),n=d("4h"),g=d("2023-01-01"),v=d("2025-01-01"),l=d(!1),r=d(0),a=d(null),b=d([]),y=["1m","5m","15m","1h","4h","1d"];D(async()=>{await f.fetchStrategies(),b.value=f.strategies});async function m(){l.value=!0,r.value=0,a.value=null;try{const p={strategy:u.value,timeframe:n.value,timerange:`${g.value.replace(/-/g,"")}-${v.value.replace(/-/g,"")}`};await _.backtest(p);const e=setInterval(async()=>{try{const s=await _.backtestStatus();r.value=s.data.progress||0,s.data.status==="ended"&&(clearInterval(e),a.value=s.data,l.value=!1)}catch{clearInterval(e),l.value=!1}},1e3)}catch(p){console.error("Backtest failed:",p),l.value=!1}}async function A(){try{await _.backtestAbort(),l.value=!1,r.value=0}catch(p){console.error("Failed to abort:",p)}}return(p,e)=>(o(),i("div",z,[e[17]||(e[17]=t("div",null,[t("h1",{class:"text-2xl font-bold text-white"},"Backtesting"),t("p",{class:"text-gray-500 text-sm"},"Test your strategy with historical data")],-1)),t("div",U,[t("div",$,[e[10]||(e[10]=t("div",{class:"card-header"},[t("span",null,"‚öôÔ∏è Configuration")],-1)),t("div",P,[t("div",null,[e[5]||(e[5]=t("label",{class:"label"},"Strategy",-1)),x(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),class:"input"},[(o(!0),i(S,null,B(b.value,s=>(o(),i("option",{key:s,value:s},c(s),9,j))),128)),e[4]||(e[4]=t("option",{value:"RSI_EMA"},"RSI_EMA",-1))],512),[[h,u.value]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"label"},"Timeframe",-1)),x(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.value=s),class:"input"},[(o(),i(S,null,B(y,s=>t("option",{key:s,value:s},c(s),9,q)),64))],512),[[h,n.value]])]),t("div",N,[t("div",null,[e[7]||(e[7]=t("label",{class:"label"},"Start Date",-1)),x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s),type:"date",class:"input"},null,512),[[C,g.value]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"label"},"End Date",-1)),x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>v.value=s),type:"date",class:"input"},null,512),[[C,v.value]])])]),l.value?(o(),i("div",G,[t("div",O,[e[9]||(e[9]=t("span",{class:"text-gray-400"},"Progress",-1)),t("span",W,c(Math.round(r.value*100))+"%",1)]),t("div",H,[t("div",{class:"h-full bg-primary transition-all duration-300",style:F({width:`${r.value*100}%`})},null,4)])])):w("",!0),t("div",J,[l.value?(o(),i("button",{key:1,onClick:A,class:"btn btn-danger flex-1"}," ‚èπÔ∏è Abort ")):(o(),i("button",{key:0,onClick:m,class:"btn btn-primary flex-1"}," üöÄ Run Backtest "))])])]),t("div",K,[a.value?(o(),i("div",Q,[e[15]||(e[15]=t("div",{class:"card-header"},[t("span",null,"üìä Results Summary")],-1)),t("div",X,[t("div",null,[e[11]||(e[11]=t("div",{class:"stat-label"},"Total Profit",-1)),t("div",Y," +"+c((a.value.profit_total_abs||0).toFixed(2))+" USDT ",1)]),t("div",null,[e[12]||(e[12]=t("div",{class:"stat-label"},"Win Rate",-1)),t("div",Z,c(((a.value.wins||0)/(a.value.total_trades||1)*100).toFixed(1))+"% ",1)]),t("div",null,[e[13]||(e[13]=t("div",{class:"stat-label"},"Total Trades",-1)),t("div",tt,c(a.value.total_trades||0),1)]),t("div",null,[e[14]||(e[14]=t("div",{class:"stat-label"},"Max Drawdown",-1)),t("div",et,c((a.value.max_drawdown_abs||0).toFixed(2))+"% ",1)])])])):w("",!0),t("div",st,[e[16]||(e[16]=t("div",{class:"card-header"},[t("span",null,"üìà Equity Curve")],-1)),t("div",at,[a.value?(o(),M(V,{key:0,data:a.value},null,8,["data"])):(o(),i("div",lt," Run a backtest to see results "))])])])])]))}});export{it as default};
