import{d as N,r as g,o as O,B as R,C as W,c as S,b as t,f as L,j as K,t as y,k as D,D as X,u as j,g as $,z as I,F as k,p as E,s as G}from"./index-2Haz5s36.js";import{i as H}from"./index-8VjjxCB0.js";const J={class:"relative w-full h-full min-h-[400px]"},Y={key:0,class:"absolute inset-0 flex items-center justify-center bg-dark-300/80 z-10"},Z={key:1,class:"absolute inset-0 flex items-center justify-center bg-dark-300/50 z-10"},q={class:"text-center"},Q={class:"text-danger mb-2"},ee=N({__name:"CandleChartContainer",props:{pair:{},timeframe:{}},setup(F){const o=F,p=g(null);let d=null;const T=g(!1),x=g(""),m=g(0),h=g(0);let u=null,i=[];function n(l){return{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","8h":"8h","12h":"12h","1d":"1d","3d":"3d","1w":"1w","1M":"1M"}[l]||"4h"}async function P(l,c,U=100){const v=l.replace("/",""),e=n(c),a=`https://api.binance.com/api/v3/klines?symbol=${v}&interval=${e}&limit=${U}`;return(await X.get(a)).data.map(s=>({time:s[0],open:parseFloat(s[1]),high:parseFloat(s[2]),low:parseFloat(s[3]),close:parseFloat(s[4]),volume:parseFloat(s[5])}))}function _(){u&&u.close();const l=o.pair.replace("/","").toLowerCase(),c=n(o.timeframe),U=`wss://stream.binance.com:9443/ws/${l}@kline_${c}`;u=new WebSocket(U),u.onmessage=v=>{try{const e=JSON.parse(v.data);if(e.k){const a=e.k,r={time:a.t,open:parseFloat(a.o),high:parseFloat(a.h),low:parseFloat(a.l),close:parseFloat(a.c),volume:parseFloat(a.v)};if(m.value=r.close,i.length>0){if(i[i.length-1].time===r.time?i[i.length-1]=r:(i.shift(),i.push(r)),i.length>0){const f=i[0].open;h.value=(r.close-f)/f*100}B()}}}catch(e){console.error("WebSocket parse error:",e)}},u.onerror=v=>{console.error("WebSocket error:",v)},u.onclose=()=>{setTimeout(()=>{o.pair&&o.timeframe&&_()},5e3)}}async function b(){if(!(!o.pair||!o.timeframe)){T.value=!0,x.value="";try{if(i=await P(o.pair,o.timeframe),i.length>0){m.value=i[i.length-1].close;const l=i[0].open;h.value=(m.value-l)/l*100}B(),_()}catch(l){console.error("Failed to load candles:",l),x.value="Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu"}finally{T.value=!1}}}function B(){if(!p.value||i.length===0)return;d||(d=H(p.value,"dark"));const l=i.map(e=>new Date(e.time).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})),c=i.map(e=>[e.open,e.close,e.low,e.high]),U=i.map(e=>e.volume),v={backgroundColor:"transparent",animation:!1,title:{text:`${o.pair}`,subtext:`$${m.value.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} (${h.value>=0?"+":""}${h.value.toFixed(2)}%)`,left:10,top:5,textStyle:{color:"#F0B90B",fontSize:16},subtextStyle:{color:h.value>=0?"#0ECB81":"#F6465D",fontSize:14,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"cross"},backgroundColor:"#1E2329",borderColor:"#2B3139",textStyle:{color:"#EAECEF"},formatter:e=>{if(!e||e.length===0)return"";const a=e.find(M=>M.seriesType==="candlestick");if(!a||!a.data)return"";const r=a.data;let s,f,w,C;if(Array.isArray(r))if(r.length>=5)[,s,f,w,C]=r;else if(r.length===4)[s,f,w,C]=r;else return"";else return"";const V=((f-s)/s*100).toFixed(2),z=f>=s?"#0ECB81":"#F6465D";return`
          <div style="font-size:12px">
            <div style="margin-bottom:4px"><b>${a.name}</b></div>
            <div>Open: $${Number(s).toLocaleString(void 0,{maximumFractionDigits:8})}</div>
            <div>High: $${Number(C).toLocaleString(void 0,{maximumFractionDigits:8})}</div>
            <div>Low: $${Number(w).toLocaleString(void 0,{maximumFractionDigits:8})}</div>
            <div>Close: $${Number(f).toLocaleString(void 0,{maximumFractionDigits:8})}</div>
            <div style="color:${z}">Change: ${V}%</div>
          </div>
        `}},grid:[{left:80,right:20,top:60,height:"50%"},{left:80,right:20,top:"72%",height:"18%"}],xAxis:[{type:"category",data:l,axisLine:{lineStyle:{color:"#2B3139"}},axisLabel:{color:"#848E9C",fontSize:9,rotate:30},gridIndex:0},{type:"category",data:l,axisLine:{lineStyle:{color:"#2B3139"}},axisLabel:{show:!1},gridIndex:1}],yAxis:[{scale:!0,axisLine:{lineStyle:{color:"#2B3139"}},axisLabel:{color:"#848E9C",formatter:e=>e>=1e3?(e/1e3).toFixed(1)+"K":e>=1?e.toLocaleString():e.toPrecision(4)},splitLine:{lineStyle:{color:"#2B3139"}},gridIndex:0},{scale:!0,axisLine:{lineStyle:{color:"#2B3139"}},axisLabel:{show:!1},splitLine:{show:!1},gridIndex:1}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:60,end:100},{show:!0,xAxisIndex:[0,1],type:"slider",bottom:5,height:20}],series:[{name:o.pair,type:"candlestick",data:c,xAxisIndex:0,yAxisIndex:0,itemStyle:{color:"#0ECB81",color0:"#F6465D",borderColor:"#0ECB81",borderColor0:"#F6465D"}},{name:"Volume",type:"bar",data:U,xAxisIndex:1,yAxisIndex:1,itemStyle:{color:e=>{const a=e.dataIndex;if(a<c.length){const[r,s]=c[a];return s>=r?"#0ECB8160":"#F6465D60"}return"#2B3139"}}}]};d.setOption(v,!0)}function A(){u&&(u.close(),u=null)}return O(()=>{b(),window.addEventListener("resize",()=>d==null?void 0:d.resize())}),R(()=>{A()}),W(()=>[o.pair,o.timeframe],()=>{A(),b()}),(l,c)=>(D(),S("div",J,[c[1]||(c[1]=t("div",{class:"absolute top-2 right-2 z-20 flex items-center gap-2 text-xs"},[t("span",{class:"flex items-center gap-1"},[t("span",{class:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),K(" LIVE ")])],-1)),T.value?(D(),S("div",Y,[...c[0]||(c[0]=[t("div",{class:"flex items-center gap-2 text-primary"},[t("svg",{class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]),t("span",null,"ƒêang t·∫£i...")],-1)])])):L("",!0),x.value&&!T.value?(D(),S("div",Z,[t("div",q,[t("div",Q,y(x.value),1),t("button",{onClick:b,class:"text-primary hover:underline text-sm"},"Th·ª≠ l·∫°i")])])):L("",!0),t("div",{ref_key:"chartRef",ref:p,class:"w-full h-full"},null,512)]))}}),te={class:"space-y-6 fade-in"},ie={class:"flex items-center justify-between flex-wrap gap-4"},oe={class:"flex items-center gap-3"},ae=["value"],se=["value"],ne={class:"flex items-center gap-4 text-sm text-gray-400"},le={class:"text-primary font-medium"},re={class:"card",style:{height:"calc(100vh - 260px)","min-height":"500px"}},ue=N({__name:"ChartsView",setup(F){const o=j(),p=g("BTC/USDT"),d=g("4h"),T=["1m","5m","15m","1h","4h","1d","1w"],x=["BTC/USDT","ETH/USDT","BNB/USDT","SOL/USDT","XRP/USDT","ADA/USDT","AVAX/USDT","DOGE/USDT","DOT/USDT","LINK/USDT","ATOM/USDT","NEAR/USDT","OP/USDT","ARB/USDT","SUI/USDT","SEI/USDT","INJ/USDT","PEPE/USDT","SHIB/USDT","FLOKI/USDT","APT/USDT","TIA/USDT","FET/USDT","IMX/USDT","GRT/USDT","FIL/USDT","RUNE/USDT","TAO/USDT","WIF/USDT","BONK/USDT","MINA/USDT","ZK/USDT","JUP/USDT","PYTH/USDT","ONDO/USDT","MANTA/USDT","AEVO/USDT","DYM/USDT","SAGA/USDT","XAI/USDT","TRB/USDT","EGLD/USDT"],m=g(x);async function h(){try{await o.fetchWhitelist(),o.whitelist&&o.whitelist.length>0&&(m.value=o.whitelist)}catch{console.log("Using default pairs list"),m.value=x}}return O(()=>{h()}),(u,i)=>(D(),S("div",te,[t("div",ie,[i[2]||(i[2]=t("div",null,[t("h1",{class:"text-2xl font-bold text-white"},"üìä Charts"),t("p",{class:"text-gray-500 text-sm"},"Xem bi·ªÉu ƒë·ªì gi√° v√† ch·ªâ b√°o k·ªπ thu·∫≠t")],-1)),t("div",oe,[$(t("select",{"onUpdate:modelValue":i[0]||(i[0]=n=>p.value=n),class:"input w-48"},[(D(!0),S(k,null,E(m.value,n=>(D(),S("option",{key:n,value:n},y(n),9,ae))),128))],512),[[I,p.value]]),$(t("select",{"onUpdate:modelValue":i[1]||(i[1]=n=>d.value=n),class:"input w-24"},[(D(),S(k,null,E(T,n=>t("option",{key:n,value:n},y(n),9,se)),64))],512),[[I,d.value]]),t("button",{onClick:h,class:"btn btn-outline text-sm"}," üîÑ ")])]),t("div",ne,[t("span",le,y(p.value),1),t("span",null,"‚è±Ô∏è "+y(d.value),1),t("span",null,y(m.value.length)+" c·∫∑p ti·ªÅn",1)]),t("div",re,[G(ee,{pair:p.value,timeframe:d.value},null,8,["pair","timeframe"])])]))}});export{ue as default};
